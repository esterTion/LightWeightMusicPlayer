window.MusicPlayer=function(t){"use strict";if(!t.element||!t.src)return!1;this.element=t.element,this.config=t,null!=document.getElementById(this.config.id||"")&&(console.warn("existing element id, ignoring and generating new id"),delete this.config.id);var e={play:'<svg style="width:18px;height:18px"><polygon style="fill:#333;stroke:#FFF" points="2,2 2,16 16,9"></polygon></svg>',pause:'<svg style="width:18px;height:18px"><polygon style="fill:#333;stroke:#FFF" points="2,2 2,16 8,16 8,2"></polygon><polygon style="fill:#333;stroke:#FFF" points="10,2 10,16 16,16 16,2"></polygon></svg>'},i={color:{played:"#FFFFFF",buffered:"#C8C7C7",blank:"#918F8F",border:"#000000"},id:"MusicPlayer_"+Date.now(),borderWidth:0,autoPlay:!1,loop:!1},o=document.createElement("div"),n=this;["id","borderWidth","autoPlay","loop"].forEach(function(t){n.config[t]=n.config[t]||i[t]}),["color"].forEach(function(t){if(void 0==n.config[t])return void(n.config[t]=i[t]);for(var e in i[t])n.config[t][e]=n.config[t][e]||i[t][e]}),o.id=this.config.id,"string"!=typeof this.config.borderWidth&&(this.config.borderWidth=this.config.borderWidth+"px"),this.element.appendChild(o),o.innerHTML='<div class="warpper"><div class="buffered"></div><div class="played"></div><div class="icon">'+e.play+"</div><style>#"+this.config.id+"{height:20px;width:100%;position:relative;background:"+this.config.color.border+";cursor:pointer;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}#"+this.config.id+" .warpper{background:"+this.config.color.blank+";position:absolute;left:"+this.config.borderWidth+";right:"+this.config.borderWidth+";top:"+this.config.borderWidth+";bottom:"+this.config.borderWidth+"}#"+this.config.id+" .buffered{position:absolute;height:100%;background:"+this.config.color.buffered+";transition:width .5s}#"+this.config.id+" .played{position:absolute;height:100%;background:"+this.config.color.played+";transition:width .5s}#"+this.config.id+' .icon{height:18px;width:18px;margin:0 auto;opacity:0.5}</style><audio src="'+this.config.src+'"></audio></div>',this.container=document.getElementById(this.config.id),this.barPlay=document.querySelector("#"+this.config.id+" .played"),this.barBuffer=document.querySelector("#"+this.config.id+" .buffered"),this.audio=document.querySelector("#"+this.config.id+" audio"),this.svgIcon=document.querySelector("#"+this.config.id+" .icon"),this.updateTime=function(t){this.barPlay.style.width=t+"%"};var s=!1,r=!1,d=!1;this.listeners={timeupdate:function(){s||n.updateTime(this.currentTime/this.duration*100);try{for(var t,e,i=0;i<this.buffered.length;i++)if(this.currentTime>this.buffered.start(i)&&this.currentTime<this.buffered.end(i)){t=this.buffered.start(i),e=this.buffered.end(i);break}if(i==this.buffered.length)throw"Not Range Found";n.barBuffer.style.width=e/this.duration*100+"%"}catch(t){return}},progress:function(){try{for(var t,e,i=0;i<this.buffered.length;i++)if(this.currentTime>this.buffered.start(i)&&this.currentTime<this.buffered.end(i)){t=this.buffered.start(i),e=this.buffered.end(i);break}if(i==this.buffered.length)throw"Not Range Found";n.barBuffer.style.width=e/this.duration*100+"%"}catch(t){return}},click:function(t){console.log("click"),r||(n.audio.paused?n.audio.play():n.audio.pause())},play:function(t){n.svgIcon.innerHTML=e.pause},pause:function(t){n.svgIcon.innerHTML=e.play},mousedown:function(t){console.log("mousedown"),d||(s=!0,r=!1,n.barPlay.style.transitionDuration="0s")},mousemove:function(t){if(!d&&s){console.log("mousemove"),r=!0;var e=parseInt(n.config.borderWidth);isNaN(e)&&(e=0);var i=(t.layerX-e)/(n.container.offsetWidth-2*e)*100;i=i>100?100:i<0?0:i,n.updateTime(i)}},mouseup:function(t){d||(console.log("mouseup"),s=!1,n.barPlay.style.transitionDuration="",r&&(t.preventDefault(),n.audio.currentTime=parseFloat(n.barPlay.style.width)*n.audio.duration/100))},touchstart:function(t){d=!0,s=!0,r=!1;var e=n.barPlay.getBoundingClientRect();n.oldTouch=[t.touches[0].clientX-e.left,t.touches[0].clientY-e.top],n.barPlay.style.transitionDuration="0s"},touchmove:function(t){var e=n.barPlay.getBoundingClientRect(),i=this.getBoundingClientRect(),o=[t.changedTouches[0].clientX-e.left,t.changedTouches[0].clientY-e.top];if(o[0]!=n.oldTouch[0]||r){if(!(o[0]>=0&&o[1]>=0&&o[0]<=i.width&&o[1]<=i.height))return n.barPlay.style.transitionDuration="",void(s=!1);n.barPlay.style.transitionDuration="0s",s=!0,t.preventDefault(),r=!0;var d=parseInt(n.config.borderWidth);isNaN(d)&&(d=0);var a=o[0]/(n.container.offsetWidth-2*d)*100;a=a>100?100:a<0?0:a,n.updateTime(a)}},touchend:function(t){s&&r&&(n.audio.currentTime=parseFloat(n.barPlay.style.width)*n.audio.duration/100),s=!1,delete n.oldTouch,n.barPlay.style.transitionDuration=""}},this.audio.addEventListener("timeupdate",this.listeners.timeupdate),this.audio.addEventListener("progress",this.listeners.progress),this.audio.addEventListener("play",this.listeners.play),this.audio.addEventListener("pause",this.listeners.pause),this.container.addEventListener("click",this.listeners.click),this.container.addEventListener("mousedown",this.listeners.mousedown),window.addEventListener("mousemove",this.listeners.mousemove),window.addEventListener("mouseup",this.listeners.mouseup),this.container.addEventListener("touchstart",this.listeners.touchstart),this.container.addEventListener("touchmove",this.listeners.touchmove),this.container.addEventListener("touchend",this.listeners.touchend),this.config.autoPlay&&this.listeners.click(),this.config.loop&&(this.audio.loop=1)};