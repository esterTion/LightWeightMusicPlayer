window.MusicPlayer=function(t){"use strict";if(!t.element||!t.src)return!1;this.element=t.element,this.config=t,null!=document.getElementById(this.config.id||"")&&(console.warn("existing element id, ignoring and generating new id"),delete this.config.id);var i,e={play:'<svg style="width:18px;height:18px"><polygon style="fill:#333;stroke:#FFF" points="2,2 2,16 16,9"></polygon></svg>',pause:'<svg style="width:18px;height:18px"><polygon style="fill:#333;stroke:#FFF" points="2,2 2,16 8,16 8,2"></polygon><polygon style="fill:#333;stroke:#FFF" points="10,2 10,16 16,16 16,2"></polygon></svg>'},o={color:{played:"#FFFFFF",buffered:"#C8C7C7",blank:"#918F8F",border:"#000000"},id:"MusicPlayer_"+Date.now(),borderWidth:0,autoPlay:!1,loop:!1},n=document.createElement("div");["id","borderWidth","autoPlay","loop"].forEach(function(t){this.config[t]=this.config[t]||o[t]}),["color"].forEach(function(t){if(void 0==this.config[t])return void(this.config[t]=o[t]);for(i in o[t])this.config[t][i]=this.config[t][i]||o[t][i]}),n.id=this.config.id,"string"!=typeof this.config.borderWidth&&(this.config.borderWidth=this.config.borderWidth+"px"),this.element.appendChild(n),n.innerHTML='<div class="warpper"><div class="buffered"></div><div class="played"></div><div class="icon">'+e.play+"</div><style>#"+this.config.id+"{height:20px;width:100%;position:relative;background:"+this.config.color.border+";cursor:pointer;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}#"+this.config.id+" .warpper{background:"+this.config.color.blank+";position:absolute;left:"+this.config.borderWidth+";right:"+this.config.borderWidth+";top:"+this.config.borderWidth+";bottom:"+this.config.borderWidth+"}#"+this.config.id+" .buffered{position:absolute;height:100%;background:"+this.config.color.buffered+";transition:width .5s}#"+this.config.id+" .played{position:absolute;height:100%;background:"+this.config.color.played+";transition:width .5s}#"+this.config.id+' .icon{height:18px;width:18px;margin:0 auto;opacity:0.5}</style><audio src="'+this.config.src+'"></audio></div>',this.container=document.getElementById(this.config.id),this.barPlay=document.querySelector("#"+this.config.id+" .played"),this.barBuffer=document.querySelector("#"+this.config.id+" .buffered"),this.audio=document.querySelector("#"+this.config.id+" audio"),this.svgIcon=document.querySelector("#"+this.config.id+" .icon");var s=this;this.updateTime=function(t){this.barPlay.style.width=t+"%"};var r=!1,d=!1,a=!1;this.listeners={timeupdate:function(){r||s.updateTime(this.currentTime/this.duration*100);try{for(var t,i,e=0;e<this.buffered.length;e++)if(this.currentTime>this.buffered.start(e)&&this.currentTime<this.buffered.end(e)){t=this.buffered.start(e),i=this.buffered.end(e);break}if(e==this.buffered.length)throw"Not Range Found";s.barBuffer.style.width=i/this.duration*100+"%"}catch(t){return}},progress:function(){try{for(var t,i,e=0;e<this.buffered.length;e++)if(this.currentTime>this.buffered.start(e)&&this.currentTime<this.buffered.end(e)){t=this.buffered.start(e),i=this.buffered.end(e);break}if(e==this.buffered.length)throw"Not Range Found";s.barBuffer.style.width=i/this.duration*100+"%"}catch(t){return}},click:function(t){console.log("click"),d||(s.audio.paused?s.audio.play():s.audio.pause())},play:function(t){s.svgIcon.innerHTML=e.pause},pause:function(t){s.svgIcon.innerHTML=e.play},mousedown:function(t){console.log("mousedown"),a||(r=!0,d=!1,s.barPlay.style.transitionDuration="0s")},mousemove:function(t){if(!a&&r){console.log("mousemove"),d=!0;var i=parseInt(s.config.borderWidth);isNaN(i)&&(i=0);var e=(t.layerX-i)/(s.container.offsetWidth-2*i)*100;e=e>100?100:e<0?0:e,s.updateTime(e)}},mouseup:function(t){a||(console.log("mouseup"),r=!1,s.barPlay.style.transitionDuration="",d&&(t.preventDefault(),s.audio.currentTime=parseFloat(s.barPlay.style.width)*s.audio.duration/100))},touchstart:function(t){a=!0,r=!0,d=!1;var i=s.barPlay.getBoundingClientRect();s.oldTouch=[t.touches[0].clientX-i.left,t.touches[0].clientY-i.top],s.barPlay.style.transitionDuration="0s"},touchmove:function(t){var i=s.barPlay.getBoundingClientRect(),e=this.getBoundingClientRect(),o=[t.changedTouches[0].clientX-i.left,t.changedTouches[0].clientY-i.top];if(o[0]!=s.oldTouch[0]||d){if(!(o[0]>=0&&o[1]>=0&&o[0]<=e.width&&o[1]<=e.height))return s.barPlay.style.transitionDuration="",void(r=!1);s.barPlay.style.transitionDuration="0s",r=!0,t.preventDefault(),d=!0;var n=parseInt(s.config.borderWidth);isNaN(n)&&(n=0);var a=o[0]/(s.container.offsetWidth-2*n)*100;a=a>100?100:a<0?0:a,s.updateTime(a)}},touchend:function(t){r&&d&&(s.audio.currentTime=parseFloat(s.barPlay.style.width)*s.audio.duration/100),r=!1,delete s.oldTouch,s.barPlay.style.transitionDuration=""}},this.audio.addEventListener("timeupdate",this.listeners.timeupdate),this.audio.addEventListener("progress",this.listeners.progress),this.audio.addEventListener("play",this.listeners.play),this.audio.addEventListener("pause",this.listeners.pause),this.container.addEventListener("click",this.listeners.click),this.container.addEventListener("mousedown",this.listeners.mousedown),window.addEventListener("mousemove",this.listeners.mousemove),window.addEventListener("mouseup",this.listeners.mouseup),this.container.addEventListener("touchstart",this.listeners.touchstart),this.container.addEventListener("touchmove",this.listeners.touchmove),this.container.addEventListener("touchend",this.listeners.touchend),this.config.autoPlay&&this.listeners.click(),this.config.loop&&(this.audio.loop=1)};